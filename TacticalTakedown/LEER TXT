// TXT.cpp : Este archivo contiene la función "main". La ejecución del programa comienza y termina ahí.
//

#include <iostream>
#include "fstream"
#include "string"
#pragma warning(disable:4996)
int** leerMatrices(const char* fileName, int& FILS, int& COLS);

using namespace std;

#define ESCALA 5 //escala de texturas
#define  MAX 100

int main()
{
	int fils = 0;
	int cols = 0;
	int** matrix = NULL;
	matrix = leerMatrices("Nivel1.txt",fils,cols);
	cout <<"LA MATRIZ ES:  "<<endl;
	for (int i = 0; i <= fils; i++) {
		for (int j = 0; j <=cols; j++)
		{
			cout << matrix[i][j] << " ";
		}
		cout << endl;

	}

}
int** leerMatrices(const char* fileName,int&FILS,int &COLS) {
	char cadena[MAX]; //cadena para leer lineas, limitado por el numero max es 100 ahora, se puede modificar
	bool flag_inicio = 0;
	int num = 0;
	int j = 0;
	int k = 0;
	int cifra = 0;
	FILE* entrada;
	/*int COLS = 0;
	int FILS = 0;*/
	int** matriz = NULL;//punto a matriz

	entrada = fopen(fileName, "r"); //se abre con fopen se necesita #pragma warning(disable:4996) para compilar
	if (entrada == NULL)

		printf("NO SE PUEDE ABRIR");
	else
	{
		fgets(cadena, 10, entrada); //Primer segmento, num columnas
		for (int n = 0; n < 2; n++) {
			if ((cadena[n] >= '0') && (cadena[n] <= '9')) {
				cifra = cadena[n] - 48; //char a int
				COLS = COLS * 10 + cifra;
			}

		}
		fgets(cadena, 10, entrada); //Segmento segunda fila, num filas

		for (int u = 0; u < 2; u++) {
			if ((cadena[u] >= '0') && (cadena[u] <= '9')) {

				cifra = cadena[u] - 48; //char a int
				FILS = FILS * 10 + cifra;
			}
		}
		matriz = new int* [FILS];//CREAMOS MATRIZ
		for (int i = 0; i <= FILS; i++) {
			matriz[i] = new int[COLS];
		}
		j = k = 0;//reset variables 
		while (!feof(entrada))
		{

			fgets(cadena, MAX, entrada);
			for (int i = 0; i < MAX; i++) {
				if (j <= FILS && k <= COLS)
				{

					if (cadena[i] == '{')//inicio fila
					{
						flag_inicio = 1;
						k = 0;
					}
					if ((cadena[i] >= '0') && (cadena[i] <= '9') && (flag_inicio == 1))
					{

						cifra = cadena[i] - 48; //char a int
						num = num * 10 + cifra; //2 cifras
						matriz[j][k] = num;

					}
					else if ((cadena[i] == ',') && (flag_inicio == 1)) {
						k++;
						num = 0;
					}
					else if ((cadena[i] == '}') && (flag_inicio == 1)) {//fin de linea
						j++;
						k = num = 0;
						flag_inicio = 0;
					}
				}

			}
		}
	}
		std::fclose(entrada);//cerramos fichero

		return matriz;
}
